
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>PSOX</title><meta name="generator" content="MATLAB 9.14"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2023-07-18"><meta name="DC.source" content="PSOX.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><pre class="codeinput"><span class="comment">% function [final,time] = PSOX(par,input)</span>
<span class="comment">% bound = [-3 3;-4 4];</span>
<span class="comment">% Configuration(par,input,bound)</span>
<span class="comment">% run('Configuration.m')</span>
clear;clc;close <span class="string">all</span>
load(<span class="string">'for_test.mat'</span>);
Configuration(par,input,bound)
<span class="keyword">if</span> flag
    final=inf;
    time=inf;
    <span class="keyword">return</span>
<span class="keyword">end</span>

<span class="keyword">global</span> inertiaW1CS prtRndCS prtInfCS inertia_cte d
<span class="keyword">global</span> it itMax Aidx deadidx bornidx
<span class="keyword">global</span> PMI_cte vmax PMR_cte pmICS pmRCS vClampCS
<span class="keyword">global</span> eI mI ScI FcI eR mR ScR FcR f_counter
ini_vel = 0;
<span class="comment">% Benchmark-Function</span>
d = 2; <span class="comment">% dimansion</span>
bound = [-3 3;-4 4];

<span class="comment">% logfile = fopen('PSOX_log.text','w');</span>
<span class="comment">% try</span>
<span class="comment">%     currentInfo(logfile)</span>
    <span class="comment">% Load initialize (pop, TOP, MOI)</span>
    [pop, X, gb, tree, rc] = INITIALIZE(bound,ini_vel);
    saveIdx = cell(1,itMax);

    <span class="keyword">for</span> it = 1:itMax
        whose
        it
        saveIdx{it} = Aidx;

        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%% update TOP MOI %%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="keyword">if</span> it &gt; 1
            [X,tree,rc]  = TOP(pop,X,tree,rc);
            X = MOI(X);

            <span class="keyword">for</span> i = Aidx
                x = X(i,it);
                <span class="comment">% w1</span>
                <span class="keyword">if</span> ismember(x.idx,bornidx) &amp;&amp; inertiaW1CS == 9
                    x.w1 = inertia_cte;
                <span class="keyword">else</span>
                    x.w1 = W1(inertia_cte,gb,x,bound,pop,X,saveIdx);
                <span class="keyword">end</span>
                <span class="comment">% w2, w3</span>
                [x.w2, x.w3] = W23(X,x);
                <span class="comment">% phi</span>
                x.phi = AC(x, gb);
                <span class="comment">% pm &amp; PrtRnd</span>
                <span class="keyword">if</span> prtRndCS ~= 0
                    <span class="keyword">if</span> ismember(x.idx,bornidx) <span class="comment">% it == 1 ||</span>
                        x.pmR = PMR_cte;
                    <span class="keyword">else</span>
                        x.pmR = PM(pmRCS,PMR_cte,eR,mR,ScR,FcR,x,X(i,it-1).pmR,gb);
                    <span class="keyword">end</span>
                    x.prtRnd = pertRnd(x.pos, x.pmR);
                <span class="keyword">else</span>
                    x.prtRnd = pertRnd(x.pos, []);
                <span class="keyword">end</span>
                <span class="comment">% Pert_Info</span>
                <span class="keyword">if</span> prtInfCS ~= 0 || prtInfCS ~= 4
                    <span class="keyword">if</span> ismember(x.idx,bornidx) <span class="comment">% it == 1 ||</span>
                        x.pmI = PMI_cte;
                    <span class="keyword">else</span>
                        x.pmI = PM(pmICS,PMI_cte,eI,mI,ScI,FcI,x,X(i,it-1).pmI,gb);
                    <span class="keyword">end</span>
                    x.prtInfo = pertInf(pop.pb.pos(i,:), x.pmI);
                <span class="keyword">else</span>
                    x.prtInfo = pertInf(pop.pb.pos(i,:), []);
                <span class="keyword">end</span>

                X(i,it) = x;
                x=[];
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="keyword">for</span> i = Aidx
            <span class="comment">% DNPP</span>
            X(i,it).dnpp = DNPP(X, X(i,it), pop, saveIdx);

            <span class="comment">%%%%%%%%%%%%%%%%%%%%% prepare next generation %%%%%%%%%%%%%%%%%%%%%</span>
            <span class="comment">% Update Velocity</span>
            X(i,it+1).v = X(i,it).w1 * X(i,it).v + X(i,it).w2 * X(i,it).dnpp + X(i,it).w3 * X(i,it).prtRnd;
            <span class="keyword">if</span> vClampCS
                X(i,it+1).v = velClamp(X(i,it+1).v,vmax);
            <span class="keyword">end</span>
            <span class="comment">% Update Position</span>
            X(i,it+1).pos = X(i,it).pos + X(i,it+1).v;
            <span class="comment">% check bound</span>
            X(i,it+1).pos = posClamp(X(i,it+1).pos,bound);
            <span class="comment">% Update Fitness</span>
            X(i,it+1).fit = f(X(i,it+1).pos);
            <span class="comment">% Update pop</span>
            pop.v(i,:,it+1) = X(i,it+1).v;
            pop.pos(i,:,it+1) = X(i,it+1).pos;
            pop.fit(i,it+1) = X(i,it+1).fit;
            pop.size(it+1) = pop.size(it);
        <span class="keyword">end</span> <span class="comment">% END i</span>

        [X(:,it+1).idx] = deal(X(:,it).idx);

        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%% update pb and gb %%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        <span class="keyword">for</span> i = Aidx
            <span class="keyword">if</span> X(i,it+1).fit &lt; X(i,it).pb.fit
                X(i,it+1).pb.pos = X(i,it+1).pos;
                X(i,it+1).pb.fit = X(i,it+1).fit;
                X(i,it+1).pb.it = it+1;
            <span class="keyword">else</span>
                X(i,it+1).pb = X(i,it).pb;
            <span class="keyword">end</span>
            pop.pb.pos(i,:) = X(i,it+1).pb.pos;
            pop.pb.fit(i) = X(i,it+1).pb.fit;
        <span class="keyword">end</span> <span class="comment">% END i (update pb)</span>
        [gb.fit(it+1), id] = min(pop.pb.fit);
        gb.pos(it+1,:) = pop.pb.pos(id,:);

        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%% unstuck &amp; reinitial %%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
        [pop, X, gb] = stagnation_detection(pop, X, gb);
        [pop, X, gb] = particles_reinitialization(pop, X, gb, bound);

        <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%% Update Population %%%%%%%%%%%%%%%%%%%%%%%%%%</span>

        pop = POP(pop,bound,gb);  <span class="comment">% +1 | +1,-1 | -1 | +particlesToAdd</span>

        <span class="keyword">if</span> numel(deadidx) ~= 0 || numel(bornidx) ~= 0  <span class="comment">% have (+ | -)</span>
            <span class="comment">% sort idxs</span>
            [~, idx] = sort(pop.fit(Aidx,it));
            Aidx = Aidx(idx);
            <span class="comment">% update personal best</span>
            <span class="keyword">if</span> numel(deadidx) ~= 0  <span class="comment">% have (-)</span>
                pop.pb.pos(deadidx,:) = inf;
                pop.pb.fit(deadidx) = inf;
            <span class="keyword">end</span>
            <span class="keyword">if</span> numel(bornidx) ~= 0  <span class="comment">% have (+)</span>
                pop.pb.pos(bornidx,:) = pop.pos(bornidx,:,it+1);
                pop.pb.fit(bornidx) = pop.fit(bornidx,it+1);
                pop.v(bornidx,:,it+1) = ini_vel;    <span class="comment">% be sorate it haye ghbl 0 ezaf mikone</span>
            <span class="keyword">end</span>
            <span class="comment">% update global best</span>
            [gb.fit(it+1), idx] = min(pop.pb.fit(Aidx));
            gb.pos(it+1,:) = pop.pb.pos(Aidx(idx),:);
            gb.idx(it+1) = Aidx(idx);

            <span class="comment">% update X</span>
            <span class="keyword">for</span> i = Aidx
                X(i,it+1).idx = i;
                X(i,it+1).pos = pop.pos(i,:,it+1);
                X(i,it+1).fit = pop.fit(i,it+1);
                X(i,it+1).v = pop.v(i,:,it+1);
                X(i,it+1).pb.pos = pop.pb.pos(i,:);
                X(i,it+1).pb.fit = pop.pb.fit(i);
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="comment">% act = bench_func(pop.pos(Aidx,:,it+1),gb.fit,pop.size(it+1));</span>
        <span class="comment">% if gb.fit(end) &lt; -6.5; break; end</span>
    <span class="keyword">end</span> <span class="comment">% END it</span>
    final = gb.fit(end);
    time=toc;
<span class="comment">%     fprintf(logfile,'\n--------------- SUCCESS --------------\n');</span>
<span class="comment">%     fprintf(logfile,'Global-Best = %f \nf_counter = %d \n',gb.fit(end),f_counter);</span>
<span class="comment">%     fprintf(logfile,'time = %d \n',time/60);</span>
<span class="comment">% catch err</span>
<span class="comment">%     fprintf(logfile,'\n--------------- ERROR --------------\n');</span>
<span class="comment">%     fprintf(logfile,'%s\n',err.message);</span>
<span class="comment">%     fprintf(logfile, 'Stack trace:\n');</span>
<span class="comment">%     for k = 1:length(err.stack)</span>
<span class="comment">%         fprintf(logfile, 'File: %s\n', err.stack(k).file);</span>
<span class="comment">%         fprintf(logfile, 'Function: %s\n', err.stack(k).name);</span>
<span class="comment">%         fprintf(logfile, 'Line: %d\n\n', err.stack(k).line);</span>
<span class="comment">%     end</span>
<span class="comment">%     fprintf(logfile, '\n');</span>
<span class="comment">%     final=inf;</span>
<span class="comment">%     time=inf;</span>
<span class="comment">% end</span>
<span class="comment">% fclose(logfile);</span>
<span class="comment">% disp("END")</span>
<span class="comment">% disp("f_counter = "+num2str(f_counter))</span>
<span class="comment">% disp("Final gb = "+num2str(gb.fit(end)))</span>
<span class="comment">% disp("Actual : "+num2str(act))</span>
</pre><pre class="codeoutput">
ans =

     0

</pre><pre class="codeoutput error">Unrecognized function or variable 'whose'.

Error in PSOX (line 31)
        whose
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023a</a><br></p></div><!--
##### SOURCE BEGIN #####
% function [final,time] = PSOX(par,input)
% bound = [-3 3;-4 4];
% Configuration(par,input,bound)
% run('Configuration.m')
clear;clc;close all
load('for_test.mat');
Configuration(par,input,bound)
if flag
    final=inf;
    time=inf;
    return
end

global inertiaW1CS prtRndCS prtInfCS inertia_cte d
global it itMax Aidx deadidx bornidx
global PMI_cte vmax PMR_cte pmICS pmRCS vClampCS
global eI mI ScI FcI eR mR ScR FcR f_counter
ini_vel = 0;
% Benchmark-Function
d = 2; % dimansion 
bound = [-3 3;-4 4];

% logfile = fopen('PSOX_log.text','w');
% try
%     currentInfo(logfile)
    % Load initialize (pop, TOP, MOI)
    [pop, X, gb, tree, rc] = INITIALIZE(bound,ini_vel);
    saveIdx = cell(1,itMax);
    
    for it = 1:itMax
        whose
        it
        saveIdx{it} = Aidx;
    
        %%%%%%%%%%%%%%%%%%%%%%%%%%% update TOP MOI %%%%%%%%%%%%%%%%%%%%%%%%%%%%
        if it > 1  
            [X,tree,rc]  = TOP(pop,X,tree,rc);
            X = MOI(X);
    
            for i = Aidx
                x = X(i,it);
                % w1
                if ismember(x.idx,bornidx) && inertiaW1CS == 9
                    x.w1 = inertia_cte;
                else
                    x.w1 = W1(inertia_cte,gb,x,bound,pop,X,saveIdx);
                end
                % w2, w3
                [x.w2, x.w3] = W23(X,x);
                % phi
                x.phi = AC(x, gb);
                % pm & PrtRnd
                if prtRndCS ~= 0
                    if ismember(x.idx,bornidx) % it == 1 || 
                        x.pmR = PMR_cte;
                    else
                        x.pmR = PM(pmRCS,PMR_cte,eR,mR,ScR,FcR,x,X(i,it-1).pmR,gb);
                    end
                    x.prtRnd = pertRnd(x.pos, x.pmR);
                else
                    x.prtRnd = pertRnd(x.pos, []);
                end
                % Pert_Info
                if prtInfCS ~= 0 || prtInfCS ~= 4
                    if ismember(x.idx,bornidx) % it == 1 || 
                        x.pmI = PMI_cte;
                    else
                        x.pmI = PM(pmICS,PMI_cte,eI,mI,ScI,FcI,x,X(i,it-1).pmI,gb);
                    end
                    x.prtInfo = pertInf(pop.pb.pos(i,:), x.pmI);
                else
                    x.prtInfo = pertInf(pop.pb.pos(i,:), []);
                end
    
                X(i,it) = x;
                x=[];
            end
        end
        
        for i = Aidx
            % DNPP
            X(i,it).dnpp = DNPP(X, X(i,it), pop, saveIdx);
    
            %%%%%%%%%%%%%%%%%%%%% prepare next generation %%%%%%%%%%%%%%%%%%%%%
            % Update Velocity 
            X(i,it+1).v = X(i,it).w1 * X(i,it).v + X(i,it).w2 * X(i,it).dnpp + X(i,it).w3 * X(i,it).prtRnd;
            if vClampCS
                X(i,it+1).v = velClamp(X(i,it+1).v,vmax);
            end
            % Update Position 
            X(i,it+1).pos = X(i,it).pos + X(i,it+1).v; 
            % check bound
            X(i,it+1).pos = posClamp(X(i,it+1).pos,bound);
            % Update Fitness
            X(i,it+1).fit = f(X(i,it+1).pos);
            % Update pop
            pop.v(i,:,it+1) = X(i,it+1).v;
            pop.pos(i,:,it+1) = X(i,it+1).pos;
            pop.fit(i,it+1) = X(i,it+1).fit;
            pop.size(it+1) = pop.size(it);
        end % END i
        
        [X(:,it+1).idx] = deal(X(:,it).idx);    
    
        %%%%%%%%%%%%%%%%%%%%%%%%% update pb and gb %%%%%%%%%%%%%%%%%%%%%%%%%%%%
        for i = Aidx    
            if X(i,it+1).fit < X(i,it).pb.fit
                X(i,it+1).pb.pos = X(i,it+1).pos;
                X(i,it+1).pb.fit = X(i,it+1).fit;
                X(i,it+1).pb.it = it+1;
            else
                X(i,it+1).pb = X(i,it).pb;
            end
            pop.pb.pos(i,:) = X(i,it+1).pb.pos;
            pop.pb.fit(i) = X(i,it+1).pb.fit;
        end % END i (update pb)
        [gb.fit(it+1), id] = min(pop.pb.fit);
        gb.pos(it+1,:) = pop.pb.pos(id,:);
       
        %%%%%%%%%%%%%%%%%%%%%%% unstuck & reinitial %%%%%%%%%%%%%%%%%%%%%%%%%%%
        [pop, X, gb] = stagnation_detection(pop, X, gb);
        [pop, X, gb] = particles_reinitialization(pop, X, gb, bound);
        
        %%%%%%%%%%%%%%%%%%%%%%%%%% Update Population %%%%%%%%%%%%%%%%%%%%%%%%%%
        
        pop = POP(pop,bound,gb);  % +1 | +1,-1 | -1 | +particlesToAdd
    
        if numel(deadidx) ~= 0 || numel(bornidx) ~= 0  % have (+ | -)
            % sort idxs
            [~, idx] = sort(pop.fit(Aidx,it));
            Aidx = Aidx(idx);
            % update personal best
            if numel(deadidx) ~= 0  % have (-)
                pop.pb.pos(deadidx,:) = inf;
                pop.pb.fit(deadidx) = inf;
            end
            if numel(bornidx) ~= 0  % have (+)
                pop.pb.pos(bornidx,:) = pop.pos(bornidx,:,it+1);
                pop.pb.fit(bornidx) = pop.fit(bornidx,it+1);
                pop.v(bornidx,:,it+1) = ini_vel;    % be sorate it haye ghbl 0 ezaf mikone
            end
            % update global best
            [gb.fit(it+1), idx] = min(pop.pb.fit(Aidx));
            gb.pos(it+1,:) = pop.pb.pos(Aidx(idx),:);
            gb.idx(it+1) = Aidx(idx);
            
            % update X
            for i = Aidx
                X(i,it+1).idx = i;
                X(i,it+1).pos = pop.pos(i,:,it+1);
                X(i,it+1).fit = pop.fit(i,it+1);
                X(i,it+1).v = pop.v(i,:,it+1);
                X(i,it+1).pb.pos = pop.pb.pos(i,:);
                X(i,it+1).pb.fit = pop.pb.fit(i);
            end
        end
    
        % act = bench_func(pop.pos(Aidx,:,it+1),gb.fit,pop.size(it+1));
        % if gb.fit(end) < -6.5; break; end
    end % END it
    final = gb.fit(end);
    time=toc;
%     fprintf(logfile,'\nREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- SUCCESS REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH\n');
%     fprintf(logfile,'Global-Best = %f \nf_counter = %d \n',gb.fit(end),f_counter);
%     fprintf(logfile,'time = %d \n',time/60);
% catch err
%     fprintf(logfile,'\nREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- ERROR REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH\n');
%     fprintf(logfile,'%s\n',err.message);
%     fprintf(logfile, 'Stack trace:\n');
%     for k = 1:length(err.stack)
%         fprintf(logfile, 'File: %s\n', err.stack(k).file);
%         fprintf(logfile, 'Function: %s\n', err.stack(k).name);
%         fprintf(logfile, 'Line: %d\n\n', err.stack(k).line);
%     end
%     fprintf(logfile, '\n');
%     final=inf;
%     time=inf;
% end
% fclose(logfile);
% disp("END")
% disp("f_counter = "+num2str(f_counter))
% disp("Final gb = "+num2str(gb.fit(end)))
% disp("Actual : "+num2str(act))
##### SOURCE END #####
--></body></html>